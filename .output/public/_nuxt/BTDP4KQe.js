import{_ as W,K as X,r as p,k as J,o as Y,S as Z,x as u,z as t,A as v,N as s,C as c,T as i,U as M,P as S,O as h,Q as ee,B,V as b,W as O,y as m,X as te}from"./bb5wy1fZ.js";import{u as se}from"./C_MYWIpT.js";import{u as le}from"./tYwOYGLs.js";const oe={class:"container py-5"},de={class:"d-flex justify-content-between align-items-center mb-4"},ae={class:"text-muted"},ie={class:"d-flex gap-2"},ne={class:"row mb-4"},re={class:"col-12"},ue={class:"card shadow-sm"},me={class:"card-body"},ce={class:"row g-3"},be={class:"col-md-4"},pe={class:"col-md-4"},ve={class:"row mb-3"},fe={class:"col-12"},ge={class:"alert alert-info d-flex justify-content-between align-items-center"},ye={key:0},ke={key:1},we={key:0},xe={class:"table-responsive"},Pe={class:"table table-striped table-hover"},Me={key:0},Se={key:1},Ce={colspan:"6",class:"text-center text-danger"},De={key:2},Ee=["src","alt"],_e={key:0,class:"badge bg-success"},Ve={key:1,class:"badge bg-secondary"},Ue=["onClick"],Ie=["onClick"],Be={class:"modal fade",id:"addProductModal",tabindex:"-1","aria-labelledby":"addProductModalLabel","aria-hidden":"true"},Oe={class:"modal-dialog modal-lg"},je={class:"modal-content"},qe={class:"modal-body"},Fe={class:"row g-3"},Ne={class:"col-md-6"},Le={class:"col-md-6"},$e={class:"col-md-6"},Te={class:"col-md-6"},Ae={class:"col-md-12"},ze={class:"col-md-12"},Ge={class:"col-md-12"},He={class:"col-md-6"},Ke={class:"form-check"},Qe={class:"modal-footer"},Re=["disabled"],We={key:0,class:"spinner-border spinner-border-sm me-2"},Xe={class:"modal fade",id:"editProductModal",tabindex:"-1","aria-labelledby":"editProductModalLabel","aria-hidden":"true"},Je={class:"modal-dialog modal-lg"},Ye={class:"modal-content"},Ze={class:"modal-body"},he={class:"row g-3"},et={class:"col-md-6"},tt={class:"col-md-6"},st={class:"col-md-6"},lt={class:"col-md-6"},ot={class:"col-md-12"},dt={class:"col-md-12"},at={class:"col-md-12"},it={class:"col-md-6"},nt={class:"form-check"},rt={class:"modal-footer"},ut=["disabled"],mt={key:0,class:"spinner-border spinner-border-sm me-2"},ct={class:"modal fade",id:"deleteProductModal",tabindex:"-1","aria-labelledby":"deleteProductModalLabel","aria-hidden":"true"},bt={class:"modal-dialog"},pt={class:"modal-content"},vt={class:"modal-footer"},ft=["disabled"],gt={key:0,class:"spinner-border spinner-border-sm me-2"},yt={__name:"crud",setup(kt){X({title:"إدارة منتجات العطور",meta:[{name:"robots",content:"noindex, nofollow"},{name:"googlebot",content:"noindex, nofollow"},{name:"description",content:"صفحة إدارة المنتجات - غير مخصصة للفهرسة"}]});const{user:C,logout:V,initAuth:j,waitForAuth:q}=se(),{getFirebaseData:F,setFirebaseData:N,updateFirebaseData:L,removeFirebaseData:$,loading:T,error:U}=le(),f=p({}),y=p(!1),k=p(!1),w=p(!1),D=p(null),a=p({name:"",description:"",price:0,discount:0,image:"",category:"",meta_desc:"",best_seller:!1}),d=p({id:"",name:"",description:"",price:0,discount:0,image:"",category:"",meta_desc:"",best_seller:!1}),n=p({category:"",bestSeller:""}),x=J(()=>{if(!f.value)return{};let o={...f.value};if(n.value.category&&(o=Object.fromEntries(Object.entries(o).filter(([e,r])=>r.category===n.value.category))),n.value.bestSeller!==""){const e=n.value.bestSeller==="true";o=Object.fromEntries(Object.entries(o).filter(([r,l])=>l.best_seller===e))}return o}),I=()=>{n.value.category="",n.value.bestSeller=""};Y(async()=>{try{const o=j();if(await q(),await P(),typeof bootstrap>"u"){const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js",document.head.appendChild(e)}Z(()=>{o&&o()})}catch(o){console.error("Error initializing CRUD page:",o)}});const P=async()=>{try{const o=await F("/products");f.value=o||{}}catch(o){console.error("Error loading products:",o)}};function A(o,e){d.value={id:o,name:e.name||"",description:e.description||"",price:e.price||0,discount:e.discount||0,image:e.image||"",category:e.category||"",meta_desc:e.meta_desc||"",best_seller:e.best_seller===!0},new bootstrap.Modal(document.getElementById("editProductModal")).show()}function z(o){D.value=o,new bootstrap.Modal(document.getElementById("deleteProductModal")).show()}async function G(){var o;y.value=!0;try{const e={name:a.value.name,description:a.value.description,price:parseFloat(a.value.price),discount:parseInt(a.value.discount)||0,image:a.value.image,category:a.value.category,meta_desc:a.value.meta_desc,best_seller:a.value.best_seller===!0,created_at:new Date().toISOString(),created_by:((o=C.value)==null?void 0:o.email)||"unknown"};await N("/products",{...f.value,[Date.now().toString()]:e}),g("تمت إضافة المنتج بنجاح","success"),a.value={name:"",description:"",price:0,discount:0,image:"",category:"",meta_desc:"",best_seller:!1},bootstrap.Modal.getInstance(document.getElementById("addProductModal")).hide(),await P()}catch(e){console.error("Error adding product:",e),g("حدث خطأ أثناء إضافة المنتج","error")}finally{y.value=!1}}async function H(){var o;k.value=!0;try{const e={name:d.value.name,description:d.value.description,price:parseFloat(d.value.price),discount:parseInt(d.value.discount)||0,image:d.value.image,category:d.value.category,meta_desc:d.value.meta_desc,best_seller:d.value.best_seller===!0,updated_at:new Date().toISOString(),updated_by:((o=C.value)==null?void 0:o.email)||"unknown"};await L(`/products/${d.value.id}`,e),g("تم تحديث المنتج بنجاح","success"),bootstrap.Modal.getInstance(document.getElementById("editProductModal")).hide(),await P()}catch(e){console.error("Error updating product:",e),g("حدث خطأ أثناء تحديث المنتج","error")}finally{k.value=!1}}async function K(){w.value=!0;try{await $(`/products/${D.value}`),g("تم حذف المنتج بنجاح","success"),bootstrap.Modal.getInstance(document.getElementById("deleteProductModal")).hide(),await P()}catch(o){console.error("Error deleting product:",o),g("حدث خطأ أثناء حذف المنتج","error")}finally{w.value=!1,D.value=null}}function g(o,e="success"){const r=document.createElement("div");r.className=`toast-${e}`,r.innerHTML=`
    <i class="bi bi-${e==="success"?"check-circle":"exclamation-triangle"}"></i>
    ${o}
  `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},3e3)}function Q(o){switch(o){case"man":return"bg-primary";case"women":return"bg-secondary";case"lapels":return"bg-success";default:return"bg-secondary"}}function R(o){switch(o){case"man":return"رجالي";case"women":return"نسائي";case"lapels":return"بلبس";default:return"غير معروف"}}return(o,e)=>{var r;return m(),u("div",oe,[t("div",de,[t("div",null,[e[20]||(e[20]=t("h1",{class:"mb-2"},"إدارة منتجات العطور",-1)),t("p",ae,"مرحباً "+v((r=s(C))==null?void 0:r.email),1)]),t("div",ie,[t("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=(...l)=>s(V)&&s(V)(...l))},e[21]||(e[21]=[t("i",{class:"bi bi-box-arrow-right me-1"},null,-1),c(" تسجيل الخروج ")])),e[22]||(e[22]=t("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#addProductModal"},[t("i",{class:"bi bi-plus-circle me-1"}),c(" إضافة منتج جديد ")],-1))])]),t("div",ne,[t("div",re,[t("div",ue,[t("div",me,[e[28]||(e[28]=t("h6",{class:"card-title mb-3"},[t("i",{class:"bi bi-funnel me-2"}),c(" تصفية المنتجات ")],-1)),t("div",ce,[t("div",be,[e[24]||(e[24]=t("label",{for:"categoryFilter",class:"form-label"},"الفئة",-1)),i(t("select",{class:"form-select",id:"categoryFilter","onUpdate:modelValue":e[1]||(e[1]=l=>s(n).category=l)},e[23]||(e[23]=[t("option",{value:""},"جميع الفئات",-1),t("option",{value:"man"},"رجالي",-1),t("option",{value:"women"},"نسائي",-1)]),512),[[M,s(n).category]])]),t("div",pe,[e[26]||(e[26]=t("label",{for:"bestSellerFilter",class:"form-label"},"الأكثر مبيعاً",-1)),i(t("select",{class:"form-select",id:"bestSellerFilter","onUpdate:modelValue":e[2]||(e[2]=l=>s(n).bestSeller=l)},e[25]||(e[25]=[t("option",{value:""},"جميع المنتجات",-1),t("option",{value:"true"},"الأكثر مبيعاً فقط",-1),t("option",{value:"false"},"غير الأكثر مبيعاً",-1)]),512),[[M,s(n).bestSeller]])]),t("div",{class:"col-md-4 d-flex align-items-end"},[t("button",{class:"btn btn-outline-secondary",onClick:I},e[27]||(e[27]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),c(" مسح التصفية ")]))])])])])])]),t("div",ve,[t("div",fe,[t("div",ge,[t("div",null,[e[29]||(e[29]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),s(n).category||s(n).bestSeller!==""?(m(),u("span",ye," تم عرض "+v(Object.keys(s(x)).length)+" منتج من أصل "+v(Object.keys(s(f)).length)+" منتج ",1)):(m(),u("span",ke," إجمالي المنتجات: "+v(Object.keys(s(f)).length)+" منتج ",1))]),s(n).category||s(n).bestSeller!==""?(m(),u("div",we,[t("button",{class:"btn btn-sm btn-outline-info",onClick:I},e[30]||(e[30]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),c(" مسح التصفية ")]))])):S("",!0)])])]),t("div",xe,[t("table",Pe,[e[38]||(e[38]=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"الصورة"),t("th",null,"الاسم"),t("th",null,"السعر"),t("th",null,"الفئة"),t("th",null,"الأكثر مبيعاً"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[s(T)?(m(),u("tr",Me,e[31]||(e[31]=[t("td",{colspan:"6",class:"text-center"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"جار التحميل...")])],-1)]))):s(U)?(m(),u("tr",Se,[t("td",Ce,[e[32]||(e[32]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),c(" "+v(s(U)),1)])])):!s(x)||Object.keys(s(x)).length===0?(m(),u("tr",De,e[33]||(e[33]=[t("td",{colspan:"6",class:"text-center"},"لا توجد منتجات متاحة",-1)]))):(m(!0),u(h,{key:3},ee(s(x),(l,E)=>(m(),u("tr",{key:E},[t("td",null,[t("img",{src:l.image,alt:l.name,style:{width:"50px",height:"50px","object-fit":"cover"},onError:e[3]||(e[3]=_=>_.target.src="/logo.png")},null,40,Ee)]),t("td",null,v(l.name),1),t("td",null,v(l.price)+" EGP",1),t("td",null,[t("span",{class:te(["badge",Q(l.category)])},v(R(l.category)),3)]),t("td",null,[l.best_seller===!0?(m(),u("span",_e,e[34]||(e[34]=[t("i",{class:"bi bi-check me-1"},null,-1),c("نعم ")]))):(m(),u("span",Ve,e[35]||(e[35]=[t("i",{class:"bi bi-x me-1"},null,-1),c("لا ")])))]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:_=>A(E,l),title:"تعديل"},e[36]||(e[36]=[t("i",{class:"bi bi-pencil-square me-1"},null,-1),c("تعديل ")]),8,Ue),t("button",{class:"btn btn-sm btn-outline-danger",onClick:_=>z(E),title:"حذف"},e[37]||(e[37]=[t("i",{class:"bi bi-trash3 me-1"},null,-1),c("حذف ")]),8,Ie)])]))),128))])])]),t("div",Be,[t("div",Oe,[t("div",je,[e[56]||(e[56]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"addProductModalLabel"},"إضافة منتج جديد"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("form",{onSubmit:B(G,["prevent"])},[t("div",qe,[t("div",Fe,[t("div",Ne,[e[39]||(e[39]=t("label",{for:"addName",class:"form-label"},"اسم المنتج",-1)),i(t("input",{type:"text",class:"form-control",id:"addName","onUpdate:modelValue":e[4]||(e[4]=l=>s(a).name=l),required:""},null,512),[[b,s(a).name]]),e[40]||(e[40]=t("div",{class:"invalid-feedback"},"يرجى إدخال اسم المنتج",-1))]),t("div",Le,[e[41]||(e[41]=t("label",{for:"addPrice",class:"form-label"},"السعر (EGP)",-1)),i(t("input",{type:"number",class:"form-control",id:"addPrice","onUpdate:modelValue":e[5]||(e[5]=l=>s(a).price=l),min:"0",step:"0.01",required:""},null,512),[[b,s(a).price]]),e[42]||(e[42]=t("div",{class:"invalid-feedback"},"يرجى إدخال سعر صحيح",-1))]),t("div",$e,[e[44]||(e[44]=t("label",{for:"addCategory",class:"form-label"},"الفئة",-1)),i(t("select",{class:"form-select",id:"addCategory","onUpdate:modelValue":e[6]||(e[6]=l=>s(a).category=l),required:""},e[43]||(e[43]=[t("option",{value:""},"اختر الفئة",-1),t("option",{value:"man"},"رجالي",-1),t("option",{value:"women"},"نسائي",-1)]),512),[[M,s(a).category]]),e[45]||(e[45]=t("div",{class:"invalid-feedback"},"يرجى اختيار الفئة",-1))]),t("div",Te,[e[46]||(e[46]=t("label",{for:"addDiscount",class:"form-label"},"الخصم (%)",-1)),i(t("input",{type:"number",class:"form-control",id:"addDiscount","onUpdate:modelValue":e[7]||(e[7]=l=>s(a).discount=l),min:"0",max:"100"},null,512),[[b,s(a).discount]])]),t("div",Ae,[e[47]||(e[47]=t("label",{for:"addDescription",class:"form-label"},"الوصف",-1)),i(t("textarea",{class:"form-control",id:"addDescription","onUpdate:modelValue":e[8]||(e[8]=l=>s(a).description=l),rows:"3",required:""},null,512),[[b,s(a).description]]),e[48]||(e[48]=t("div",{class:"invalid-feedback"},"يرجى إدخال وصف المنتج",-1))]),t("div",ze,[e[49]||(e[49]=t("label",{for:"addImage",class:"form-label"},"رابط الصورة",-1)),i(t("input",{type:"url",class:"form-control",id:"addImage","onUpdate:modelValue":e[9]||(e[9]=l=>s(a).image=l),required:""},null,512),[[b,s(a).image]]),e[50]||(e[50]=t("div",{class:"invalid-feedback"},"يرجى إدخال رابط صحيح للصورة",-1))]),t("div",Ge,[e[51]||(e[51]=t("label",{for:"addMetaDesc",class:"form-label"},"وصف SEO",-1)),i(t("textarea",{class:"form-control",id:"addMetaDesc","onUpdate:modelValue":e[10]||(e[10]=l=>s(a).meta_desc=l),rows:"2",required:""},null,512),[[b,s(a).meta_desc]]),e[52]||(e[52]=t("div",{class:"invalid-feedback"},"يرجى إدخال وصف SEO",-1))]),t("div",He,[t("div",Ke,[i(t("input",{class:"form-check-input",type:"checkbox",id:"addBestSeller","onUpdate:modelValue":e[11]||(e[11]=l=>s(a).best_seller=l)},null,512),[[O,s(a).best_seller]]),e[53]||(e[53]=t("label",{class:"form-check-label",for:"addBestSeller"},"الأكثر مبيعاً",-1))])])])]),t("div",Qe,[e[55]||(e[55]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"إغلاق",-1)),t("button",{type:"submit",class:"btn btn-primary",disabled:s(y)},[s(y)?(m(),u("span",We)):S("",!0),e[54]||(e[54]=c(" حفظ المنتج "))],8,Re)])],32)])])]),t("div",Xe,[t("div",Je,[t("div",Ye,[e[74]||(e[74]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"editProductModalLabel"},"تعديل المنتج"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("form",{onSubmit:B(H,["prevent"])},[t("div",Ze,[t("div",he,[t("div",et,[e[57]||(e[57]=t("label",{for:"editName",class:"form-label"},"اسم المنتج",-1)),i(t("input",{type:"text",class:"form-control",id:"editName","onUpdate:modelValue":e[12]||(e[12]=l=>s(d).name=l),required:""},null,512),[[b,s(d).name]]),e[58]||(e[58]=t("div",{class:"invalid-feedback"},"يرجى إدخال اسم المنتج",-1))]),t("div",tt,[e[59]||(e[59]=t("label",{for:"editPrice",class:"form-label"},"السعر (EGP)",-1)),i(t("input",{type:"number",class:"form-control",id:"editPrice","onUpdate:modelValue":e[13]||(e[13]=l=>s(d).price=l),min:"0",step:"0.01",required:""},null,512),[[b,s(d).price]]),e[60]||(e[60]=t("div",{class:"invalid-feedback"},"يرجى إدخال سعر صحيح",-1))]),t("div",st,[e[62]||(e[62]=t("label",{for:"editCategory",class:"form-label"},"الفئة",-1)),i(t("select",{class:"form-select",id:"editCategory","onUpdate:modelValue":e[14]||(e[14]=l=>s(d).category=l),required:""},e[61]||(e[61]=[t("option",{value:""},"اختر الفئة",-1),t("option",{value:"man"},"رجالي",-1),t("option",{value:"women"},"نسائي",-1)]),512),[[M,s(d).category]]),e[63]||(e[63]=t("div",{class:"invalid-feedback"},"يرجى اختيار الفئة",-1))]),t("div",lt,[e[64]||(e[64]=t("label",{for:"editDiscount",class:"form-label"},"الخصم (%)",-1)),i(t("input",{type:"number",class:"form-control",id:"editDiscount","onUpdate:modelValue":e[15]||(e[15]=l=>s(d).discount=l),min:"0",max:"100"},null,512),[[b,s(d).discount]])]),t("div",ot,[e[65]||(e[65]=t("label",{for:"editDescription",class:"form-label"},"الوصف",-1)),i(t("textarea",{class:"form-control",id:"editDescription","onUpdate:modelValue":e[16]||(e[16]=l=>s(d).description=l),rows:"3",required:""},null,512),[[b,s(d).description]]),e[66]||(e[66]=t("div",{class:"invalid-feedback"},"يرجى إدخال وصف المنتج",-1))]),t("div",dt,[e[67]||(e[67]=t("label",{for:"editImage",class:"form-label"},"رابط الصورة",-1)),i(t("input",{type:"url",class:"form-control",id:"editImage","onUpdate:modelValue":e[17]||(e[17]=l=>s(d).image=l),required:""},null,512),[[b,s(d).image]]),e[68]||(e[68]=t("div",{class:"invalid-feedback"},"يرجى إدخال رابط صحيح للصورة",-1))]),t("div",at,[e[69]||(e[69]=t("label",{for:"editMetaDesc",class:"form-label"},"وصف SEO",-1)),i(t("textarea",{class:"form-control",id:"editMetaDesc","onUpdate:modelValue":e[18]||(e[18]=l=>s(d).meta_desc=l),rows:"2",required:""},null,512),[[b,s(d).meta_desc]]),e[70]||(e[70]=t("div",{class:"invalid-feedback"},"يرجى إدخال وصف SEO",-1))]),t("div",it,[t("div",nt,[i(t("input",{class:"form-check-input",type:"checkbox",id:"editBestSeller","onUpdate:modelValue":e[19]||(e[19]=l=>s(d).best_seller=l)},null,512),[[O,s(d).best_seller]]),e[71]||(e[71]=t("label",{class:"form-check-label",for:"editBestSeller"},"الأكثر مبيعاً",-1))])])])]),t("div",rt,[e[73]||(e[73]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"إغلاق",-1)),t("button",{type:"submit",class:"btn btn-primary",disabled:s(k)},[s(k)?(m(),u("span",mt)):S("",!0),e[72]||(e[72]=c(" حفظ التعديلات "))],8,ut)])],32)])])]),t("div",ct,[t("div",bt,[t("div",pt,[e[77]||(e[77]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"deleteProductModalLabel"},"تأكيد الحذف"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e[78]||(e[78]=t("div",{class:"modal-body"},[t("p",null,"هل أنت متأكد أنك تريد حذف هذا المنتج؟ لا يمكن التراجع عن هذا الإجراء.")],-1)),t("div",vt,[e[76]||(e[76]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"إلغاء",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:K,disabled:s(w)},[s(w)?(m(),u("span",gt)):S("",!0),e[75]||(e[75]=c(" حذف "))],8,ft)])])])])])}}},Mt=W(yt,[["__scopeId","data-v-8bdf1f97"]]);export{Mt as default};
